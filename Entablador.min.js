var CAMBIOS_TABLAS={},Entablador_tipos_edicion=["inline","modal"],EditedSVG='<svg class="ml-1 mb-1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="currentColor" version="1.1" width="15px" height="15px" viewBox="0 0 528.899 528.899" xml:space="preserve"><g><path d="M328.883,89.125l107.59,107.589l-272.34,272.34L56.604,361.465L328.883,89.125z M518.113,63.177l-47.981-47.981   c-18.543-18.543-48.653-18.543-67.259,0l-45.961,45.961l107.59,107.59l53.611-53.611   C532.495,100.753,532.495,77.559,518.113,63.177z M0.3,512.69c-1.958,8.812,5.998,16.708,14.811,14.565l119.891-29.069   L27.473,390.597L0.3,512.69z"/></g></svg>',NewSVG='<svg class="mb-1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="15px" height="15px" viewBox="0 0 512 512" version="1.1"><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="scheduler" fill="currentColor" transform="translate(85.333333, 85.333333)"><path d="M170.666667,1.42108547e-14 C264.923264,-3.10380131e-15 341.333333,76.4100694 341.333333,170.666667 C341.333333,264.923264 264.923264,341.333333 170.666667,341.333333 C76.4100694,341.333333 2.57539587e-14,264.923264 1.42108547e-14,170.666667 C2.6677507e-15,76.4100694 76.4100694,3.15255107e-14 170.666667,1.42108547e-14 Z M192,85.3333333 L149.333333,85.3333333 L149.333333,149.333333 L85.3333333,149.333333 L85.3333333,192 L149.333333,191.999333 L149.333333,256 L192,256 L191.999333,191.999333 L256,192 L256,149.333333 L191.999333,149.333333 L192,85.3333333 Z" id="Combined-Shape"></path></g></g></svg>',inputsValidos=["text","number","checkbox","date","datetime-local","time","file","image"],MESES=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"];let ENTABLADOR=function(){function n(e){var o;if("string"==typeof e&&""!=e)return null==document.getElementById(e)?(console.error("'#"+e+"' no existe"),null):(o=window[e])instanceof Element?(console.error("Aún no has creado la tabla! '#"+e+"' es solo un elemento HTML"),this):{id:e,tipoEdicion(e){return Entablador_tipos_edicion.includes(e)?o.table().node().setAttribute("data-editable-type",e):console.error("Tipo de edición no válido. Tipos válidos:",Entablador_tipos_edicion),this},editable(e){return o.table().node().classList.toggle("editable",e),this},guardar(e){return this},eliminar(){return null==o||o instanceof Element||o.destroy(),this},add(e){return null==o||"object"!=typeof o||o instanceof Element||(Array.isArray(e)?"object"==typeof e[0]?o.rows.add(e).draw():null!=e[0]&&o.row.add(e).draw():o.row.add(e).draw()),this},draw(){return console.log("Drawing table"),null==o||o instanceof Element||o.draw(),this},meta(e){return e.key&&(o.key=e.key),e.inputsTypes&&(o.inputsTypes=e.inputsTypes),this},editableStatus(){return o.table().node().classList.contains("editable")}};console.error("No se ha especificado un ID")}return{id:n,crear:function(e){if("object"!=typeof e||0===Object.keys(e).length)console.error("No se ha especificado una configuración correctamente");else if(e.id&&"string"==typeof e.id&&""!=e.id)if(null==document.getElementById(e.id))console.error("No se ha encontrado el ID especificado (",e.id,")");else{if(window[e.id]instanceof Element){e.id;if(e.columnDefs){columnDefs=e.columnDefs;var o=!1;for(let e=0;e<columnDefs.length;e++)if("locale-compare"==columnDefs.type){o=!0;break}o||columnDefs.unshift({type:"locale-compare",targets:"_all"})}else columnDefs=[{type:"locale-compare",targets:"_all"}];var t={language:{url:"https://cdn.datatables.net/plug-ins/1.10.25/i18n/Spanish.json"},autoWidth:e.autoWidth||!1,columnDefs:columnDefs,order:e.order||[[1,"asc"]]},t=(e.columns&&(t.columns=e.columns),new DataTable("#"+e.id,t));return $("#"+e.id).on("preDraw.dt",function(){$("#"+e.id+'[data-toggle="tooltip"]').tooltip("hide")}),$("#"+e.id).on("draw.dt",function(){$("#"+e.id+'[data-toggle="tooltip"]').tooltip()}),window[e.id]=t,$("#"+e.id+" tbody").on("click","tr td",function(){$(this).closest("table").hasClass("editable")&&ENTABLADOR_EDITAR_TABLA(window[e.id],this)}),n(e.id)}console.error("Ya existe una tabla con el ID especificado (",e.id,")")}else console.error("No se ha especificado un ID")}}}();function ENTABLADOR_EDITAR_TABLA(o,e){console.log("-----------------------------------------------"),console.log("ENT_TABLA",o),console.log("el",e);var t,n,a=o.table().node().id,l=$(e),i=o.row(e).data(),s=(console.log(o.data().toArray()),o.cell(e).index().column),r=o.row(l).index(),d=o.cell(e).data(),c=o.settings().init().aoColumns[s].data,u=o.cell({row:r,column:s});console.log("TablaID:",a),console.log("row",i),console.log("indexCelda",s),console.log("indexRow",r),console.log("originalContent",d),console.log("nombreColumna",c),console.log("cellDataTables",u),console.log("-----------------------------------------------"),$(e).hasClass("editable")?(s=$(e).closest("table").attr("data-editable-type"),Entablador_tipos_edicion.includes(s)||(console.warn("Tipo de edición ('"+s+"') no válido para la tabla '#"+a+"'. Por defecto puesto '"+Entablador_tipos_edicion[0]+"'. Tipos válidos:",Entablador_tipos_edicion),s=Entablador_tipos_edicion[0]),"inline"==s&&(t=$('<input type="text">').val(d),r="text",o.inputsTypes&&o.inputsTypes[c]&&inputsValidos.includes(o.inputsTypes[c])&&(r=o.inputsTypes[c],console.log("type_input",r),t=("checkbox"==o.inputsTypes[c]?(r="checkbox",$(`<select>
                    <option value="true">Sí</option>
                    <option value="false">No</option>
                  </select>`)):$(`<input type="${r}">`)).val(d)),l.empty().html(t),t.on("click",function(e){e.stopPropagation()}),n=!1,t.focus(),t.on("keydown",function(e){"INPUT"===e.target.tagName&&("Enter"===e.key&&t.blur(),"Escape"===e.key)&&(console.log("Escape!!!"),n=!0,t.blur())}),t.on("blur",function(){var e;newContent=t.val().replace(/"/g,"'").replace(/`/g,"'").trim(),n?(l.empty(),u.data(d).draw(!1)):newContent==d?l.empty().text(d):(u.data(newContent).draw(!1),l.addClass("td-editado text-primary font-weight-bold"),l.attr("title","Campo Editado"),console.log("row",i),e=i.id,CAMBIOS_TABLAS[a]||(CAMBIOS_TABLAS[a]={cambios:{},eliminados:[]}),CAMBIOS_TABLAS[a].cambios[e]||(CAMBIOS_TABLAS[a].cambios[e]={}),CAMBIOS_TABLAS[a].cambios[e][c]=newContent,console.log("CAMBIOS_TABLAS['"+a+"']",CAMBIOS_TABLAS[a]),i[c]=newContent,o.draw())}))):alert("Este campo no se puede editar.\nProbablemente porque se genera automáticamente.")}function getNewID(e){var o=e.reduce((e,o)=>{o=Number(o.id);return!isNaN(o)&&e<o?o:e},-1/0);if(null==e[o])return o+1;console.error("Error: No se pudo obtener un nuevo ID!")}ENTABLADOR.crear({id:"TABLA",columns:[{data:"id",visible:!0},{data:"nombre",class:"editable"},{data:"edad",class:"editable"},{data:"fechaNacimiento",class:"editable"},{data:"humano",class:"editable"}],columnDefs:[{targets:1,render:function(e,o,t,n){return e.toUpperCase()}},{targets:3,render:function(e,o,t,n){return null==e?e:`${(e=new Date(e)).getDate()} ${MESES[e.getMonth()]} `+e.getFullYear()}},{targets:4,render:function(e,o,t,n){return"true"==e?"Verdadero":"Falso"}}]}).editable(!0).tipoEdicion("inline").add([{id:1,nombre:"Caliope",edad:30,fechaNacimiento:"2000-12-10",humano:"false"},{id:2,nombre:"Matthew",edad:18,fechaNacimiento:"2010-11-23",humano:"true"},{id:3,nombre:"Lucien's",edad:35,fechaNacimiento:"1992-02-17",humano:"false"}]).meta({key:"id",inputsTypes:{nombre:"text",edad:"number",fechaNacimiento:"date",humano:"checkbox"}});