var CAMBIOS_TABLAS={},Entablador_tipos_edicion=["inline","modal"];let ENTABLADOR=function(){function n(e){var o;if("string"==typeof e&&""!=e)return null==document.getElementById(e)?(console.error("'#"+e+"' no existe"),null):(o=window[e])instanceof Element?(console.error("Aún no has creado la tabla! '#"+e+"' es solo un elemento HTML"),this):{id:e,tipoEdicion(e){return Entablador_tipos_edicion.includes(e)?o.table().node().setAttribute("data-editable-type",e):console.error("Tipo de edición no válido. Tipos válidos:",Entablador_tipos_edicion),this},editable(e){return o.table().node().classList.toggle("editable",e),this},guardar(e){return this},eliminar(){return null==o||o instanceof Element||o.destroy(),this},add(e){return null==o||"object"!=typeof o||o instanceof Element||(Array.isArray(e)?"object"==typeof e[0]?o.rows.add(e).draw():null!=e[0]&&o.row.add(e).draw():o.row.add(e).draw()),this},draw(){return console.log("Drawing table"),null==o||o instanceof Element||o.draw(),this}};console.error("No se ha especificado un ID")}return{id:n,crear:function(e){if("object"!=typeof e||0===Object.keys(e).length)console.error("No se ha especificado una configuración correctamente");else if(e.id&&"string"==typeof e.id&&""!=e.id)if(null==document.getElementById(e.id))console.error("No se ha encontrado el ID especificado (",e.id,")");else{if(window[e.id]instanceof Element){e.id;if(e.columnDefs){columnDefs=e.columnDefs;var o=!1;for(let e=0;e<columnDefs.length;e++)if("locale-compare"==columnDefs.type){o=!0;break}o||columnDefs.unshift({type:"locale-compare",targets:"_all"})}else columnDefs=[{type:"locale-compare",targets:"_all"}];var t={language:{url:"https://cdn.datatables.net/plug-ins/1.10.25/i18n/Spanish.json"},autoWidth:e.autoWidth||!1,columnDefs:columnDefs,order:e.order||[[1,"asc"]]},t=(e.columns&&(t.columns=e.columns),new DataTable("#"+e.id,t));return $("#"+e.id).on("preDraw.dt",function(){$("#"+e.id+'[data-toggle="tooltip"]').tooltip("hide")}),$("#"+e.id).on("draw.dt",function(){$("#"+e.id+'[data-toggle="tooltip"]').tooltip()}),window[e.id]=t,$("#"+e.id+" tbody").on("click","tr td",function(){$(this).closest("table").hasClass("editable")&&ENTABLADOR_EDITAR_TABLA(TABLA,this)}),n(e.id)}console.error("Ya existe una tabla con el ID especificado (",e.id,")")}else console.error("No se ha especificado un ID")}}}();function ENTABLADOR_EDITAR_TABLA(o,e){console.log("-----------------------------------------------"),console.log("TABLA",o),console.log("el",e);var t=o.table().node().id,n=$(e),i=o.row(e).data(),a=o.cell(e).index().column,l=o.cell(e).data(),d=o.settings().init().aoColumns[a].data;console.log("TablaID:",t),console.log("row",i),console.log("indiceCelda",a),console.log("originalContent",l),console.log("nombreColumna",d),console.log("-----------------------------------------------"),$(e).hasClass("editable")?(a=$(e).closest("table").attr("data-editable-type"),Entablador_tipos_edicion.includes(a)||(console.warn("Tipo de edición ('"+a+"') no válido para la tabla '#"+t+"'. Por defecto puesto '"+Entablador_tipos_edicion[0]+"'. Tipos válidos:",Entablador_tipos_edicion),a=Entablador_tipos_edicion[0]),console.log(a),"inline"==a&&(input=$('<input type="text">').val(l),n.empty().html(input),input.on("click",function(e){e.stopPropagation()}),input.focus(),input.on("keydown",function(e){"INPUT"===e.target.tagName&&("Enter"===e.key&&input.blur(),"Escape"===e.key)&&n.empty().html(l)}),input.on("blur",function(){var e;(newContent=input.val().replace(/"/g,"'").replace(/`/g,"'").trim())==l?n.empty().text(l):(n.empty().text(newContent),n.addClass("td-editado"),n.attr("title","Campo Editado"),console.log("row",i),e=i.id,CAMBIOS_TABLAS[t]||(CAMBIOS_TABLAS[t]={cambios:{},eliminados:[]}),CAMBIOS_TABLAS[t].cambios[e]||(CAMBIOS_TABLAS[t].cambios[e]={}),CAMBIOS_TABLAS[t].cambios[e][d]=newContent,console.log("CAMBIOS_TABLAS['"+t+"']",CAMBIOS_TABLAS[t]),i[d]=newContent,o.draw())}))):alert("Este campo no se puede editar.\nProbablemente porque se genera automáticamente.")}function getNewID(e){var o=e.reduce((e,o)=>{o=Number(o.id);return!isNaN(o)&&e<o?o:e},-1/0);if(null==e[o])return o+1;console.error("Error: No se pudo obtener un nuevo ID!")}ENTABLADOR.crear({id:"TABLA",columns:[{data:"id",visible:!0},{data:"nombre"},{data:"edad",class:"editable"},{data:"fechaNacimiento"}]}).editable(!0).tipoEdicion("inline").add([{id:1,nombre:"Caliope",edad:30,fechaNacimiento:"23/03/1993"},{id:2,nombre:"Matthew",edad:18,fechaNacimiento:"17/08/1985"},{id:3,nombre:"Lucien's",edad:35,fechaNacimiento:"06/10/1990"}]);